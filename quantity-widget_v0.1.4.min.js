!function(){"use strict";(()=>{const t=[],e=()=>{const t=document.querySelectorAll('input[data-jb-input="quantity"]');0!==t.length?(t.forEach(t=>{a(t)}),setTimeout(()=>{o()},100)):console.warn("No quantity inputs found on this page")},a=t=>{const e=t.closest("[data-quantity-container]")||t.parentElement,a=e.querySelector(".addminusbutton.addbutton"),o=e.querySelector(".addminusbutton.minusbutton");if(!a||!o)return void console.error("Could not find add/minus buttons for quantity input:",t);if("true"===t.dataset.quantityInitialized)return;t.dataset.quantityInitialized="true";const u=e=>{const a=t.valueAsNumber||0,o=a+e;if(o>=1){const e=a;t.value=o,t.setAttribute("value",o),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0})),n(o,e,t)}};a.addEventListener("click",t=>{t.preventDefault(),u(1)}),o.addEventListener("click",t=>{t.preventDefault(),u(-1)}),t.addEventListener("input",()=>{const e=t.valueAsNumber,a=parseInt(t.dataset.lastValue)||e;isNaN(e)||e<1?(t.value=1,t.setAttribute("value",1),n(1,a,t)):(t.setAttribute("value",e),n(e,a,t)),t.dataset.lastValue=t.value}),t.dataset.lastValue=t.value||"1"},n=(e,a,n)=>{setTimeout(()=>{t.forEach(t=>{try{t({quantity:e,oldQuantity:a,input:n,container:n.closest("[data-quantity-container]")||n.parentElement})}catch(t){console.error("Error in onQuantityChange callback:",t)}})},0)},o=()=>{const t=document.querySelectorAll('a[data-jb-use-cart="true"]');if(0===t.length)return void console.log("No cart buttons found");console.log(`Found ${t.length} cart button(s)`);const e=t=>{if(t.dataset.productName&&t.dataset.productPrice&&t.dataset.productSku)return{name:t.dataset.productName,price:parseFloat(t.dataset.productPrice)||0,sku:t.dataset.productSku,image:t.dataset.productImage||"",weight:parseFloat(t.dataset.productWeight)||20};const e=document.querySelector("[data-product-name]");return e?{name:e.dataset.productName||"",price:parseFloat(e.dataset.productPrice)||0,sku:e.dataset.productSku||"",image:e.dataset.productImage||"",weight:parseFloat(e.dataset.productWeight)||20}:(console.error("No product data found for button:",t),null)},a=(t,e,a)=>{if(!a)return void console.error("Cannot update button URL: missing product data");const n=((t,e)=>`https://nextdayreagents.foxycart.com/cart?${new URLSearchParams({name:t.name,price:`${t.price}USD`,code:t.sku,image:t.image,weight:t.weight,quantity:e}).toString()}`)(a,e);t.href=n,t.dataset.currentQuantity=e,console.log("Button URL updated:",{sku:a.sku,quantity:e,url:n})};t.forEach(t=>{if("true"===t.dataset.cartInitialized)return;t.dataset.cartInitialized="true";const n=e(t);if(!n)return void console.error("Skipping button - no product data found");t.dataset.productDataCache=JSON.stringify(n);const o=(t=>{const e=t.dataset.productSku;if(e){const t=document.querySelector(`input[data-jb-input="quantity"][data-product-sku="${e}"]`);if(t)return t}const a=t.closest("[data-quantity-container]");if(a){const t=a.querySelector('input[data-jb-input="quantity"]');if(t)return t}return document.querySelector('input[data-jb-input="quantity"]')})(t);if(o){const e=o.valueAsNumber||1;a(t,e,n)}else console.warn("No quantity input found for button, using quantity of 1"),a(t,1,n);t.addEventListener("click",e=>{const a=t.dataset.currentQuantity||1;console.log("Navigating to cart:",{product:n.name,sku:n.sku,quantity:a})})}),window.onQuantityChange(n=>{const o=n.input.dataset.productSku;if(o){const t=document.querySelectorAll(`a[data-jb-use-cart="true"][data-product-sku="${o}"]`);t.forEach(t=>{const o=t.dataset.productDataCache?JSON.parse(t.dataset.productDataCache):e(t);o&&a(t,n.quantity,o)}),console.log(`Updated ${t.length} button(s) for SKU: ${o}, Quantity: ${n.quantity}`)}else t.forEach(t=>{const o=t.dataset.productDataCache?JSON.parse(t.dataset.productDataCache):e(t);o&&a(t,n.quantity,o)})})};window.onQuantityChange=e=>{"function"==typeof e?t.push(e):console.error("onQuantityChange expects a function as argument")},window.offQuantityChange=e=>{const a=t.indexOf(e);a>-1&&t.splice(a,1)},window.clearQuantityCallbacks=()=>{t.length=0},window.reinitQuantitySelectors=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e(),window.addEventListener("load",()=>{document.querySelectorAll('a[data-jb-use-cart="true"]:not([data-cart-initialized="true"])').length>0&&(console.log("Reinitializing Foxy Cart after window load..."),setTimeout(()=>{o()},200))})})()}();
